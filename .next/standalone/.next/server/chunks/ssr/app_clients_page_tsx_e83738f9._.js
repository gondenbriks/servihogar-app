module.exports=[59102,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(78560),f=a.i(28099),g=a.i(87532),h=a.i(17371);let i=(0,a.i(70106).default)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);var j=a.i(33508),k=a.i(33441),l=a.i(67453),m=a.i(73570),n=a.i(91965),o=a.i(45222),p=a.i(8406),q=a.i(92759),r=a.i(46842),s=a.i(4720),t=a.i(75750);function u(){let a=(0,d.useRouter)(),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(new Set),[y,z]=(0,c.useState)([]),[A,B]=(0,c.useState)(new Date),[C,D]=(0,c.useState)(""),[E,F]=(0,c.useState)(!0),[G,H]=(0,c.useState)("all"),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)({national_id:"",name:"",phone:"",address:""}),[M,N]=(0,c.useState)(!1),[O,P]=(0,c.useState)([]),[Q,R]=(0,c.useState)(!1),[S,T]=(0,c.useState)(!1),[U,V]=(0,c.useState)("maintenance"),W=c.default.useRef(null);(0,c.useEffect)(()=>{X();let a=e.supabase.channel("clients-changes").on("postgres_changes",{event:"*",schema:"public",table:"clients"},()=>{X(),B(new Date)}).subscribe();return()=>{e.supabase.removeChannel(a)}},[]);let X=async()=>{F(!0);try{let{data:a,error:b}=await e.supabase.from("clients").select(`
                    *,
                    service_orders (
                        scheduled_at,
                        equipment (
                            type,
                            brand
                        )
                    )
                `).order("full_name");if(b)throw b;let c=(a||[]).map(a=>{let b=(a.service_orders||[]).sort((a,b)=>new Date(b.scheduled_at||0).getTime()-new Date(a.scheduled_at||0).getTime()),c=b.length>0?b[0]:null;return{id:a.id,name:a.full_name,nationalId:a.national_id,phone:a.phone,address:a.address,category:a.category,lastServiceDate:c?.scheduled_at,lastAppliance:c?.equipment?`${c.equipment.type} ${c.equipment.brand}`:void 0,initials:a.full_name.split(" ").map(a=>a[0]).join("").toUpperCase().substring(0,2),color:"bg-indigo-600"}});z(c)}catch(a){console.error("Error loading clients:",a)}finally{F(!1)}},Y=a=>{if(!a)return{label:"Sin Visitas",color:"text-gray-500",bg:"bg-gray-500/10",icon:n.History,status:"ok"};let b=new Date(a),c=new Date,d=(c.getFullYear()-b.getFullYear())*12+(c.getMonth()-b.getMonth());return d>=12?{label:"Mantenimiento Vencido",color:"text-rose-500",bg:"bg-rose-500/10",icon:m.AlertTriangle,status:"expired"}:d>=10?{label:"Próximo Vencimiento",color:"text-amber-500",bg:"bg-amber-500/10",icon:i,status:"upcoming"}:{label:"Al día",color:"text-emerald-500",bg:"bg-emerald-500/10",icon:l.CheckCircle2,status:"ok"}},Z=(0,c.useMemo)(()=>y.filter(a=>!!(a.name.toLowerCase().includes(C.toLowerCase())||a.nationalId&&a.nationalId.includes(C))&&("all"===G||Y(a.lastServiceDate).status===G)),[y,C,G]),$=(0,c.useMemo)(()=>{let a={all:y.length,expired:0,upcoming:0,ok:0};return y.forEach(b=>{let c=Y(b.lastServiceDate);a[c.status]++}),a},[y]),_=()=>{v(!u),x(new Set),P([])},aa=async a=>{let b=a.target.files?.[0];if(!b)return;T(!0);let c=new FileReader;c.onload=async a=>{try{let b=a.target?.result,c=t.read(b,{type:"binary"}),d=c.SheetNames[0],f=c.Sheets[d],g=t.utils.sheet_to_json(f);if(0===g.length)return void alert("El archivo Excel está vacío");let h=g.map(a=>({national_id:String(a.Cedula||a.Identificacion||a.ID||a["Cedula/DNI"]||""),full_name:String(a.Nombre||a["Nombre Completo"]||a.Name||""),phone:String(a.Telefono||a.Celular||a.Phone||""),address:String(a.Direccion||a.Address||"Cali, Colombia"),email:String(a.Email||a.Correo||""),category:"REGULAR"})).filter(a=>a.national_id&&a.full_name);if(0===h.length)return void alert('No se encontraron clientes válidos. El Excel debe tener columnas como "Cedula", "Nombre", "Telefono".');let{error:i}=await e.supabase.from("clients").upsert(h,{onConflict:"national_id"});if(i)throw i;alert(`\xa1\xc9xito! Se han importado/actualizado ${h.length} clientes.`),await X()}catch(a){console.error("Error importando Excel:",a),alert("Error al procesar el archivo: "+a.message)}finally{T(!1),W.current&&(W.current.value="")}},c.readAsBinaryString(b)},ab=async a=>{a.preventDefault(),F(!0);try{let{error:a}=await e.supabase.from("clients").insert({national_id:K.national_id,full_name:K.name,phone:K.phone,address:K.address,category:"REGULAR"});if(a)throw a;await X(),J(!1),L({national_id:"",name:"",phone:"",address:""})}catch(a){alert(a.message)}finally{F(!1)}},ac=async(a="maintenance")=>{R(!0),V(a),N(!0);let b=y.filter(a=>w.has(a.id));P(b.map(a=>({clientId:a.id,clientName:a.name,phone:a.phone,message:"Generando mensaje...",status:"generating"})));for(let c=0;c<b.length;c++){let d=b[c];d.name,d.lastAppliance;try{let b=await (0,f.generatePersonalizedMessage)(d.name,d.lastAppliance||"equipo",a);P(a=>a.map(a=>a.clientId===d.id?{...a,message:b,status:"ready"}:a))}catch(a){console.error(a)}}R(!1)};return(0,b.jsxs)("div",{className:"bg-[#0a0c10] min-h-screen text-white pb-32 max-w-md mx-auto relative font-sans",children:[(0,b.jsxs)("header",{className:"sticky top-0 z-40 bg-[#0a0c10]/95 backdrop-blur-md pt-6 pb-4 px-6 border-b border-white/5 transition-all",children:[(0,b.jsx)("div",{className:"flex justify-between items-center mb-6",children:u?(0,b.jsxs)("div",{className:"flex items-center gap-4 w-full",children:[(0,b.jsx)("button",{onClick:_,className:"p-2 hover:bg-gray-800 rounded-full transition-colors",children:(0,b.jsx)(j.X,{size:20})}),(0,b.jsxs)("h1",{className:"text-xl font-black flex-1",children:[w.size," seleccionados"]}),(0,b.jsx)("button",{onClick:()=>{w.size===Z.length?x(new Set):x(new Set(Z.map(a=>a.id)))},className:"text-[10px] font-black uppercase tracking-widest text-[#135bec] bg-[#135bec]/10 px-4 py-2 rounded-xl",children:w.size===Z.length?"Ninguno":"Todos"})]}):(0,b.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("h1",{className:"text-2xl font-black tracking-tight",children:"Clientes"}),(0,b.jsxs)("p",{className:"text-[8px] font-bold text-gray-600 uppercase tracking-widest mt-0.5",children:["Sincronizado: ",A.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("input",{type:"file",ref:W,onChange:aa,className:"hidden",accept:".xlsx, .xls, .csv"}),(0,b.jsx)("button",{onClick:()=>W.current?.click(),className:"p-3 bg-gray-900 border border-white/5 rounded-2xl text-emerald-500 hover:bg-gray-800 transition-all active:scale-95 relative",disabled:S,children:S?(0,b.jsx)("div",{className:"size-5 border-2 border-emerald-500/20 border-t-emerald-500 rounded-full animate-spin"}):(0,b.jsx)(s.FileText,{size:20})}),(0,b.jsx)("button",{onClick:()=>J(!0),className:"p-3 bg-gray-900 border border-white/5 rounded-2xl text-[#135bec] hover:bg-gray-800 transition-all active:scale-95",children:(0,b.jsx)(h.UserPlus,{size:20})}),(0,b.jsxs)("button",{onClick:_,className:`flex items-center gap-2 px-4 py-3 rounded-2xl font-black text-[10px] uppercase tracking-widest transition-all active:scale-95 ${u?"bg-[#135bec] text-white shadow-lg":"bg-gray-900 border border-white/5 text-gray-400"}`,children:[(0,b.jsx)(i,{size:18}),"Gestionar"]})]})]})}),!u&&(0,b.jsxs)("div",{className:"space-y-5",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(g.Search,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500",size:18}),(0,b.jsx)("input",{className:"w-full bg-gray-900/50 border border-white/5 rounded-2xl py-4 pl-12 pr-4 text-white placeholder-gray-600 focus:outline-none focus:border-[#135bec] transition-all text-sm font-medium",placeholder:"Nombre o identificación...",value:C,onChange:a=>D(a.target.value)})]}),(0,b.jsx)("div",{className:"flex gap-2 overflow-x-auto no-scrollbar",children:[{id:"all",label:"Todos",count:$.all},{id:"expired",label:"Vencidos",count:$.expired,color:"text-rose-500"},{id:"upcoming",label:"Próximos",count:$.upcoming,color:"text-amber-500"},{id:"ok",label:"Al día",count:$.ok,color:"text-emerald-500"}].map(a=>(0,b.jsxs)("button",{onClick:()=>H(a.id),className:`shrink-0 px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-[0.15em] border transition-all ${G===a.id?"bg-white text-black border-white":`bg-gray-900 border-white/5 ${a.color||"text-gray-500"}`}`,children:[a.label," (",a.count,")"]},a.id))})]})]}),(0,b.jsx)("main",{className:"p-6 space-y-4",children:E?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 animate-pulse",children:[(0,b.jsx)("div",{className:"size-12 border-4 border-[#135bec]/20 border-t-[#135bec] rounded-full animate-spin mb-4"}),(0,b.jsx)("p",{className:"text-xs font-black uppercase tracking-widest text-gray-600",children:"Sincronizando Base de Datos"})]}):0===Z.length?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-24 text-gray-600 border-2 border-dashed border-white/5 rounded-[2.5rem]",children:[(0,b.jsx)(r.User,{size:48,className:"mb-4 opacity-20"}),(0,b.jsx)("p",{className:"font-bold text-sm",children:"Sin coincidencias encontradas"})]}):Z.map(c=>{let d=Y(c.lastServiceDate),e=w.has(c.id),f=d.icon;return(0,b.jsxs)("div",{onClick:()=>{var b;let d;return u?(b=c.id,({stopPropagation:()=>{}}).stopPropagation(),void((d=new Set(w)).has(b)?d.delete(b):d.add(b),x(d))):a.push(`/client-profile/${c.id}`)},className:`relative flex items-center justify-between p-5 rounded-[2.5rem] border transition-all active:scale-[0.98] cursor-pointer group overflow-hidden ${e?"bg-[#135bec]/10 border-[#135bec] shadow-[0_10px_40px_rgba(19,91,236,0.1)]":"bg-gray-900/40 border-white/5 hover:border-white/10 hover:bg-gray-800/40"}`,children:[e&&(0,b.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-1.5 bg-[#135bec] shadow-[0_0_15px_rgba(19,91,236,1)]"}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[u&&(0,b.jsx)("div",{className:`shrink-0 size-7 rounded-xl border-2 flex items-center justify-center transition-all duration-300 ${e?"bg-[#135bec] border-[#135bec] scale-110 shadow-lg shadow-[#135bec]/30":"border-gray-700"}`,children:e&&(0,b.jsx)(k.Check,{size:14,className:"text-white",strokeWidth:4})}),(0,b.jsx)("div",{className:`size-14 rounded-2xl bg-gradient-to-br from-indigo-500 to-indigo-700 flex items-center justify-center font-black text-lg text-white shadow-xl transition-all duration-500 ${e?"scale-90 rotate-3":"shadow-indigo-500/10"}`,children:c.initials}),(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("h3",{className:`font-black tracking-tight transition-colors duration-300 ${e?"text-white":"text-gray-200"} text-sm truncate max-w-[140px]`,children:c.name}),"PREMIUM"===c.category&&(0,b.jsx)("span",{className:"text-[7px] font-black bg-amber-500/10 text-amber-500 border border-amber-500/20 px-1.5 py-0.5 rounded-md uppercase tracking-tighter",children:"Gold"}),"ENTERPRISE"===c.category&&(0,b.jsx)("span",{className:"text-[7px] font-black bg-[#135bec]/10 text-[#135bec] border border-[#135bec]/20 px-1.5 py-0.5 rounded-md uppercase tracking-tighter",children:"Corp"})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)("p",{className:"text-[10px] text-gray-500 font-bold uppercase tracking-widest",children:c.phone}),(0,b.jsxs)("div",{className:`flex items-center gap-1.5 px-3 py-1.5 rounded-xl text-[8px] font-black uppercase tracking-widest border border-white/5 transition-all duration-300 ${d.bg} ${d.color}`,children:[(0,b.jsx)(f,{size:12}),d.label,c.lastServiceDate&&(0,b.jsxs)("span",{className:"opacity-40 ml-1",children:["(",new Date(c.lastServiceDate).toLocaleDateString(),")"]})]})]})]})]}),!u&&(0,b.jsx)("button",{onClick:a=>{a.stopPropagation();let b=`Hola ${c.name}, le contactamos de ServiHogar para agendar un mantenimiento preventivo de su ${c.lastAppliance||"equipo"}. \xbfEn qu\xe9 horario le gustar\xeda agendar?`;window.open(`https://wa.me/${c.phone.replace(/\D/g,"")}?text=${encodeURIComponent(b)}`,"_blank")},className:"p-3.5 bg-gray-900 border border-white/5 rounded-2xl text-gray-500 hover:text-[#25D366] hover:border-[#25D366]/20 transition-all hover:bg-[#25D366]/5",children:(0,b.jsx)(o.MessageCircle,{size:20})})]},c.id)})}),(0,b.jsx)("div",{className:`fixed bottom-28 left-6 right-6 max-w-md mx-auto z-[60] transition-all duration-500 transform ${u&&w.size>0?"translate-y-0 opacity-100 scale-100":"translate-y-32 opacity-0 scale-95"}`,children:(0,b.jsxs)("div",{className:"bg-[#135bec] rounded-[2rem] p-5 shadow-[0_20px_50px_rgba(19,91,236,0.5)] border border-white/20 flex flex-col gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"text-white font-black text-lg leading-none",children:[w.size," Clientes"]}),(0,b.jsx)("p",{className:"text-[9px] text-white/70 uppercase font-black tracking-widest mt-1",children:"Acción Masiva con ServiBot"})]}),(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsx)("button",{className:"size-10 rounded-xl bg-white/10 flex items-center justify-center text-white hover:bg-white/20 transition-all",children:(0,b.jsx)(q.Send,{size:18})})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsxs)("button",{onClick:()=>ac("maintenance"),className:"bg-white/10 hover:bg-white/20 border border-white/5 p-3 rounded-xl flex flex-col items-center gap-1 transition-all group",children:[(0,b.jsx)(n.History,{size:16,className:"text-white group-hover:scale-110 transition-transform"}),(0,b.jsx)("span",{className:"text-[8px] font-black uppercase tracking-tighter text-white/90",children:"Mantenimiento"})]}),(0,b.jsxs)("button",{onClick:()=>ac("promo"),className:"bg-white/10 hover:bg-white/20 border border-white/5 p-3 rounded-xl flex flex-col items-center gap-1 transition-all group",children:[(0,b.jsx)(p.Sparkles,{size:16,className:"text-white group-hover:scale-110 transition-transform"}),(0,b.jsx)("span",{className:"text-[8px] font-black uppercase tracking-tighter text-white/90",children:"Promoción"})]}),(0,b.jsxs)("button",{onClick:()=>ac("payment"),className:"bg-white/10 hover:bg-white/20 border border-white/5 p-3 rounded-xl flex flex-col items-center gap-1 transition-all group",children:[(0,b.jsx)(s.FileText,{size:16,className:"text-white group-hover:scale-110 transition-transform"}),(0,b.jsx)("span",{className:"text-[8px] font-black uppercase tracking-tighter text-white/90",children:"Cobranza"})]}),(0,b.jsxs)("button",{onClick:()=>ac("general"),className:"bg-white text-[#135bec] p-3 rounded-xl flex flex-col items-center gap-1 shadow-lg font-black transition-all hover:scale-[1.02]",children:[(0,b.jsx)(o.MessageCircle,{size:16}),(0,b.jsx)("span",{className:"text-[8px] font-black uppercase tracking-tighter",children:"General"})]})]})]})}),M&&(0,b.jsx)("div",{className:"fixed inset-0 z-[110] flex items-end justify-center bg-black/90 backdrop-blur-md p-4",children:(0,b.jsxs)("div",{className:"bg-[#0a0c10] w-full max-w-md h-[85vh] rounded-t-[3rem] border-t border-white/10 flex flex-col animate-in slide-in-from-bottom duration-500",children:[(0,b.jsxs)("div",{className:"p-8 border-b border-white/5 flex justify-between items-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-black text-xl",children:"ServiBot IA"}),(0,b.jsx)("p",{className:"text-[10px] text-[#135bec] font-black uppercase tracking-widest mt-1",children:"Generando Mensajes Únicos"})]}),(0,b.jsx)("button",{onClick:()=>N(!1),className:"p-3 bg-gray-900 rounded-full text-gray-500",children:(0,b.jsx)(j.X,{size:20})})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 no-scrollbar",children:O.map((a,c)=>(0,b.jsxs)("div",{className:`p-6 rounded-[2rem] border transition-all ${"sent"===a.status?"bg-black/40 border-white/5 opacity-50":"bg-gray-900 border-white/5 shadow-xl"}`,children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-black text-sm",children:a.clientName}),(0,b.jsx)("p",{className:"text-[9px] text-gray-500 font-bold tracking-widest uppercase mt-1",children:a.phone})]}),"generating"===a.status&&(0,b.jsx)("div",{className:"size-4 border-2 border-[#135bec]/30 border-t-[#135bec] rounded-full animate-spin"}),"sent"===a.status&&(0,b.jsx)(l.CheckCircle2,{className:"text-[#00ff9d]",size:16})]}),(0,b.jsx)("textarea",{className:"w-full bg-black/40 border border-white/5 rounded-2xl p-4 text-[13px] text-gray-300 h-28 resize-none focus:outline-none focus:border-[#135bec] transition-all font-medium leading-relaxed",value:a.message,onChange:a=>{let b=[...O];b[c].message=a.target.value,P(b)}}),(0,b.jsxs)("button",{onClick:()=>{let b;return b=`https://wa.me/${a.phone.replace(/\s+/g,"")}?text=${encodeURIComponent(a.message)}`,void(window.open(b,"_blank"),P(b=>b.map(b=>b.clientId===a.clientId?{...b,status:"sent"}:b)))},disabled:"ready"!==a.status,className:`w-full mt-4 py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest flex items-center justify-center gap-2 transition-all ${"ready"===a.status?"bg-[#25D366] text-white":"bg-gray-800 text-gray-600"}`,children:[(0,b.jsx)(q.Send,{size:14}),"sent"===a.status?"Enviado":"Enviar WhatsApp"]})]},a.clientId))})]})}),I&&(0,b.jsx)("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/90 backdrop-blur-md p-6",children:(0,b.jsxs)("div",{className:"bg-[#0a0c10] w-full max-w-sm rounded-[3rem] border border-white/10 p-8",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,b.jsx)("h2",{className:"text-2xl font-black",children:"Nuevo Cliente"}),(0,b.jsx)("button",{onClick:()=>J(!1),className:"p-2 text-gray-500",children:(0,b.jsx)(j.X,{size:24})})]}),(0,b.jsxs)("form",{onSubmit:ab,className:"space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-[10px] font-black uppercase tracking-widest text-gray-500 ml-1",children:"Cédula / DNI"}),(0,b.jsx)("input",{required:!0,className:"w-full bg-gray-900 border border-white/5 rounded-2xl p-4 text-sm",value:K.national_id,onChange:a=>L({...K,national_id:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-[10px] font-black uppercase tracking-widest text-gray-500 ml-1",children:"Nombre"}),(0,b.jsx)("input",{required:!0,className:"w-full bg-gray-900 border border-white/5 rounded-2xl p-4 text-sm",value:K.name,onChange:a=>L({...K,name:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-[10px] font-black uppercase tracking-widest text-gray-500 ml-1",children:"Teléfono"}),(0,b.jsx)("input",{required:!0,className:"w-full bg-gray-900 border border-white/5 rounded-2xl p-4 text-sm",value:K.phone,onChange:a=>L({...K,phone:a.target.value})})]}),(0,b.jsx)("button",{className:"w-full py-4 bg-[#135bec] text-white rounded-2xl font-black uppercase text-xs tracking-[0.2em] shadow-lg shadow-[#135bec]/20",children:"Crear Registro"})]})]})})]})}a.s(["default",()=>u],59102)}];

//# sourceMappingURL=app_clients_page_tsx_e83738f9._.js.map